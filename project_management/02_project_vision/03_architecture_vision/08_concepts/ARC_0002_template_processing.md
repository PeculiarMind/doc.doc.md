## Template Processing

**Author:** Architect Agent  
**Created on:** 2026-03-01  
**Last Updated:** 2026-03-01  
**Status:** Proposed


**Version History**  
| Date       | Author       | Description                |
|------------|--------------|----------------------------|
| 2026-03-01 | Architect Agent | Initial concept creation from legacy documentation |

**Table of Contents:**  
- [Problem Statement](#problem-statement)
- [Scope](#scope)
- [Proposed Solution](#proposed-solution)
- [Benefits](#benefits)
- [Challenges and Risks](#challenges-and-risks)
- [Implementation Plan](#implementation-plan)
- [Conclusion](#conclusion)
- [References](#references)


### Problem Statement
Users need a consistent way to generate documentation output for different types of files. The output format should be customizable but follow a predictable structure. A template-based approach allows users to define the output format while the system populates it with file-specific data gathered from various plugins.

### Scope
This concept defines the template processing mechanism in doc.doc.md, including template structure, variable substitution, and template resolution.

### In Scope
- Template file structure and syntax
- Variable placeholder syntax and substitution rules
- Standard set of template variables
- Template resolution order (user-specified, custom, built-in)
- Variable sources (file system, plugins, system)
- Template discovery mechanism

### Out of Scope
- Complex templating logic (conditionals, loops)
- Template inheritance or composition
- Custom variable formatting functions
- Template validation or linting
- Template versioning
- Multi-language template support

### Proposed Solution

#### Template Structure

Templates are markdown files with placeholder variables that are replaced with file-specific data.

Example template:
```markdown
# {{fileName}}

**Path**: {{filePath}}
**Size**: {{fileSizeHuman}}
**Type**: {{mimeType}}
**Modified**: {{fileModified}}

## Metadata

- **Permissions**: {{permissions}}
- **Owner**: {{fileOwner}}
- **Created**: {{fileCreated}}

## Content Summary

{{contentSummary}}

---
*Generated by doc.doc.md on {{generationTimestamp}}*
```

#### Variable Substitution

The system supports the following standard variables:

| Variable | Source | Example Value |
|----------|--------|---------------|
| `{{fileName}}` | File system | `report.pdf` |
| `{{filePath}}` | File system | `/input/docs/2024/report.pdf` |
| `{{fileSize}}` | stat plugin | `1048576` |
| `{{fileSizeHuman}}` | stat plugin | `1.0 MB` |
| `{{mimeType}}` | file plugin | `application/pdf` |
| `{{mimeDescription}}` | file plugin | `PDF document, version 1.7` |
| `{{fileModified}}` | stat plugin | `2024-02-25 14:30:00` |
| `{{fileCreated}}` | stat plugin | `2024-02-20 09:15:00` |
| `{{permissions}}` | stat plugin | `rw-r--r--` |
| `{{fileOwner}}` | stat plugin | `user:group` |
| `{{contentSummary}}` | Content plugins | Plugin-specific |
| `{{generationTimestamp}}` | System | `2024-02-25 15:00:00` |

#### Template Resolution Order

The system searches for templates in the following order:

1. **User-specified template**: Via `--template` parameter
2. **Custom template**: In `~/.config/doc.doc.md/templates/default.md`
3. **Built-in template**: In `/usr/local/share/doc.doc.md/templates/default.md`

The first template found is used for processing.

#### Variable Substitution Process

1. Load the appropriate template file
2. Collect data from file system (name, path)
3. Execute applicable plugins and gather their outputs
4. Aggregate all data into a variable dictionary
5. Replace all `{{variableName}}` placeholders with corresponding values
6. Handle missing variables by leaving placeholder or showing error
7. Write the processed template to the output file

### Benefits
- **Customizability**: Users can create their own templates for specific needs
- **Consistency**: All files are processed with the same template structure
- **Simplicity**: Simple variable substitution is easy to understand and maintain
- **Extensibility**: New variables can be added through plugins
- **Markdown-native**: Templates are markdown files, familiar to most users
- **No learning curve**: Simple placeholder syntax requires no special knowledge

### Challenges and Risks
- **Limited logic**: Simple substitution doesn't support conditionals or loops
- **Missing variables**: Need to handle cases where plugin data is unavailable
- **Template errors**: Invalid templates could cause processing failures
- **Performance**: Large templates with many variables may slow processing
- **Compatibility**: Template format changes could break existing user templates
- **Variable naming**: Need clear conventions to avoid conflicts

### Implementation Plan
1. **Phase 1**: Implement basic template loading from file
2. **Phase 2**: Implement simple variable substitution for file system variables
3. **Phase 3**: Add template resolution order (user, custom, built-in)
4. **Phase 4**: Integrate plugin outputs into variable dictionary
5. **Phase 5**: Handle missing variables gracefully
6. **Phase 6**: Create default built-in template
7. **Phase 7**: Document template creation guidelines and variable reference
8. **Phase 8**: Add template validation and error reporting

### Conclusion
The template processing concept provides a simple yet flexible way to customize documentation output. By using markdown templates with variable placeholders, users can define their preferred output format while the system handles data collection and substitution. The template resolution order ensures users can customize templates without modifying system files, and the extensible variable system allows plugins to contribute additional data.

### References
- Original concepts documentation: [08_concepts_old.md](08_concepts_old.md)
- Markdown syntax specification
- Plugin architecture concept: [ARC_0003_plugin_architecture.md](ARC_0003_plugin_architecture.md)
